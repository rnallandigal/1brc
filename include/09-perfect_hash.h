#pragma once

#include <cstdint>
#include <string>
#include <vector>

#include <fmt/format.h>

namespace rinku::brc::perfect_hash {

struct elem_t {
    int64_t min = 1000, sum = 0, max = -1000, count = 0;
};

struct map_t {
    std::vector<elem_t> slots;
    int64_t n;

    map_t(int64_t size) : slots(size), n(size) {}

    void add(char const* name, int64_t len, int64_t temp);

    int64_t phash(char const* name, int64_t len);
};

using soln_t = map_t;

template <int N>
std::vector<soln_t> solve(std::string const& datafile);
std::string print(std::vector<soln_t> const& soln);

template <int N>
std::string run(std::string const& datafile);

// Perfect hash generated with gperf
constexpr int64_t TOTAL_KEYWORDS = 413;
constexpr int64_t MIN_WORD_LENGTH = 3;
constexpr int64_t MAX_WORD_LENGTH = 26;
constexpr int64_t MIN_HASH_VALUE = 5;
constexpr int64_t MAX_HASH_VALUE = 1268;

constexpr uint16_t hash_lookup_table[] = {
    1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269,
    1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269,
    1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 110,  1269, 1269, 1269,
    1269, 1269, 1269, 0,    1269, 0,    1269, 1269, 1269, 0,    0,    1269,
    1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269,
    1269, 1269, 1269, 1269, 1269, 145,  10,   240,  65,   175,  33,   413,
    320,  280,  30,   190,  325,  0,    340,  335,  170,  1269, 385,  105,
    115,  40,   456,  190,  0,    340,  0,    1269, 1269, 1269, 1269, 1269,
    1269, 0,    280,  280,  310,  15,   15,   250,  225,  5,    210,  35,
    25,   90,   0,    30,   325,  5,    5,    20,   105,  200,  275,  315,
    5,    260,  130,  1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269,
    1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269,
    1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 0,    1269, 1269,
    1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269,
    5,    325,  1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269,
    1269, 1269, 1269, 1269, 20,   1269, 1269, 1269, 10,   1269, 1269, 1269,
    1269, 1269, 1269, 5,    10,   0,    1269, 1269, 1269, 1269, 1269, 1269,
    1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269,
    1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269,
    1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269,
    1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269, 1269,
    1269, 1269, 1269, 1269
};

constexpr char const* cities[] = {
    "",
    "",
    "",
    "",
    "",
    "Xi'an",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Miami",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Bratislava",
    "Berlin",
    "",
    "",
    "",
    "Milan",
    "Manila",
    "",
    "\303\234r\303\274mqi",
    "",
    "Busan",
    "Bergen",
    "",
    "Montreal",
    "Barcelona",
    "",
    "Burnie",
    "",
    "Bordeaux",
    "Marseille",
    "Fianarantsoa",
    "Minneapolis",
    "",
    "Murmansk",
    "Milwaukee",
    "Boise",
    "",
    "Makurdi",
    "",
    "",
    "",
    "Ulaanbaatar",
    "",
    "",
    "",
    "",
    "",
    "",
    "Belgrade",
    "Baltimore",
    "Mango",
    "Boston",
    "",
    "Makassar",
    "",
    "Dhaka",
    "Bilbao",
    "Mek'ele",
    "Jos",
    "",
    "Minsk",
    "Durban",
    "Jakarta",
    "Denpasar",
    "Melbourne",
    "Birao",
    "Darwin",
    "",
    "",
    "Fresno",
    "",
    "Bosaso",
    "Bangkok",
    "",
    "",
    "",
    "Denver",
    "",
    "Flores,  Pet\303\251n",
    "",
    "",
    "Manama",
    "Mombasa",
    "",
    "Dili",
    "",
    "Mumbai",
    "",
    "",
    "",
    "Fukuoka",
    "",
    "Bishkek",
    "Dushanbe",
    "",
    "",
    "Sana'a",
    "Moncton",
    "Djibouti",
    "",
    "Dakar",
    "Dallas",
    "",
    "",
    "Bata",
    "",
    "",
    "",
    "",
    "Toamasina",
    "Sofia",
    "Tirana",
    "",
    "",
    "Singapore",
    "",
    "Muscat",
    "Dolisie",
    "",
    "Saskatoon",
    "",
    "Dikson",
    "Tbilisi",
    "Blantyre",
    "",
    "",
    "",
    "Bloemfontein",
    "San Juan",
    "",
    "",
    "Taipei",
    "Toliara",
    "",
    "",
    "",
    "Thi\303\250s",
    "Tallinn",
    "",
    "Jerusalem",
    "",
    "\304\260zmir",
    "Toronto",
    "San Jose",
    "",
    "Tunis",
    "",
    "Tripoli",
    "",
    "Aden",
    "St. John's",
    "Brazzaville",
    "Thessaloniki",
    "",
    "Alexandra",
    "Alexandria",
    "Bamako",
    "Dampier",
    "",
    "",
    "Praia",
    "Austin",
    "Atlanta",
    "Santo Domingo",
    "",
    "",
    "San Francisco",
    "Frankfurt",
    "Adelaide",
    "",
    "",
    "",
    "Philadelphia",
    "Dar es Salaam",
    "",
    "Seoul",
    "Ankara",
    "Troms\303\270",
    "",
    "",
    "",
    "Kankan",
    "",
    "Alice Springs",
    "",
    "",
    "",
    "Karonga",
    "Damascus",
    "Maun",
    "Kandi",
    "",
    "Kuala Lumpur",
    "",
    "San Diego",
    "Tampa",
    "Port-Gentil",
    "Phoenix",
    "Portland (OR)",
    "",
    "Tokyo",
    "Batumi",
    "",
    "Kingston",
    "Pontianak",
    "Paris",
    "Bangui",
    "Kolkata",
    "Pretoria",
    "Kano",
    "",
    "Arkhangelsk",
    "San Salvador",
    "",
    "",
    "Wellington",
    "Washington, D.C.",
    "Seattle",
    "",
    "",
    "Whitehorse",
    "Bissau",
    "Palermo",
    "",
    "Marrakesh",
    "Porto",
    "Banjul",
    "Saint-Pierre",
    "",
    "",
    "",
    "Asmara",
    "Z\303\274rich",
    "Benghazi",
    "Baku",
    "",
    "Tamale",
    "",
    "",
    "",
    "",
    "Astana",
    "Managua",
    "Brussels",
    "",
    "Chiang Mai",
    "Kuopio",
    "",
    "Canberra",
    "",
    "",
    "Antsiranana",
    "",
    "Mandalay",
    "Stockholm",
    "",
    "Cairns",
    "",
    "Edmonton",
    "",
    "Bridgetown",
    "",
    "Beijing",
    "Zanzibar City",
    "Amsterdam",
    "",
    "Sokoto",
    "Chicago",
    "Tashkent",
    "Monterrey",
    "Kyoto",
    "Da Lat",
    "Kampala",
    "",
    "Charlotte",
    "",
    "San Antonio",
    "Antananarivo",
    "",
    "Port Vila",
    "Port Sudan",
    "Douala",
    "",
    "Mexicali",
    "",
    "",
    "Baguio",
    "",
    "Upington",
    "",
    "",
    "Ifrane",
    "Pointe-Noire",
    "",
    "",
    "Cairo",
    "Kumasi",
    "Detroit",
    "",
    "Juba",
    "Medan",
    "Monaco",
    "",
    "Brisbane",
    "Bujumbura",
    "",
    "Tamanrasset",
    "El Paso",
    "Tauranga",
    "",
    "",
    "Beirut",
    "Honiara",
    "",
    "Hanga Roa",
    "Lhasa",
    "",
    "Tijuana",
    "",
    "",
    "Hanoi",
    "Harbin",
    "Palm Springs",
    "",
    "",
    "Omaha",
    "Malabo",
    "Memphis",
    "",
    "",
    "Split",
    "Tehran",
    "Fairbanks",
    "Hargeisa",
    "",
    "Ouahigouya",
    "Harare",
    "Niigata",
    "",
    "Hiroshima",
    "Odesa",
    "Dublin",
    "Jacksonville",
    "Sarajevo",
    "Lyon",
    "Dubai",
    "London",
    "",
    "Helsinki",
    "",
    "",
    "Skopje",
    "Abidjan",
    "Shanghai",
    "Heraklion",
    "",
    "Moscow",
    "Halifax",
    "",
    "Abha",
    "Ndola",
    "Yangon",
    "",
    "",
    "",
    "",
    "Lisbon",
    "Dunedin",
    "Columbus",
    "Suva",
    "",
    "Lusaka",
    "Nairobi",
    "Bulawayo",
    "",
    "",
    "Prague",
    "Colombo",
    "Khartoum",
    "Oslo",
    "",
    "Athens",
    "",
    "Surabaya",
    "",
    "Sochi",
    "",
    "",
    "",
    "Bucharest",
    "",
    "Tabora",
    "Erzurum",
    "",
    "",
    "",
    "",
    "",
    "",
    "N'Djamena",
    "",
    "Anadyr",
    "Parakou",
    "Istanbul",
    "",
    "",
    "Yellowknife",
    "Nakhon Ratchasima",
    "Kinshasa",
    "Guadalajara",
    "Sacramento",
    "Toluca",
    "Seville",
    "",
    "",
    "Accra",
    "Tucson",
    "Da Nang",
    "Suwa\305\202ki",
    "",
    "",
    "Belize City",
    "Algiers",
    "",
    "",
    "",
    "",
    "",
    "Hamilton",
    "Mahajanga",
    "Garissa",
    "",
    "",
    "Rostov-on-Don",
    "",
    "",
    "Palmerston North",
    "Kunming",
    "Winnipeg",
    "Chihuahua",
    "Chi\310\231in\304\203u",
    "Albuquerque",
    "",
    "La Ceiba",
    "St. Louis",
    "",
    "Kansas City",
    "Irkutsk",
    "",
    "",
    "",
    "Maputo",
    "",
    "",
    "San Jos\303\251",
    "",
    "Dodoma",
    "",
    "",
    "Kyiv",
    "",
    "Andorra la Vella",
    "Vienna",
    "",
    "Anchorage",
    "",
    "Saint Petersburg",
    "Wichita",
    "Ashgabat",
    "",
    "",
    "Addis Ababa",
    "Karachi",
    "",
    "Valencia",
    "Ouarzazate",
    "",
    "",
    "Villahermosa",
    "Rome",
    "Phnom Penh",
    "",
    "Sapporo",
    "Changsha",
    "",
    "Vancouver",
    "",
    "Christchurch",
    "City of San Marino",
    "Valletta",
    "",
    "",
    "Vladivostok",
    "",
    "",
    "Erbil",
    "Lake Tekapo",
    "",
    "Vilnius",
    "Salt Lake City",
    "",
    "Warsaw",
    "Johannesburg",
    "",
    "Podgorica",
    "",
    "Los Angeles",
    "Yakutsk",
    "",
    "",
    "Kabul",
    "",
    "",
    "",
    "",
    "Pittsburgh",
    "Panama City",
    "Calgary",
    "",
    "",
    "",
    "Tabriz",
    "",
    "",
    "",
    "",
    "Las Palmas de Gran Canaria",
    "Conakry",
    "Wroc\305\202aw",
    "Palembang",
    "",
    "Ouagadougou",
    "",
    "",
    "",
    "Willemstad",
    "Zagreb",
    "Cotonou",
    "Honolulu",
    "Ghanzi",
    "",
    "Mexico City",
    "Port Moresby",
    "",
    "Ljubljana",
    "Gangtok",
    "",
    "",
    "Gjoa Haven",
    "Oulu",
    "",
    "Nassau",
    "",
    "Tel Aviv",
    "Naha",
    "Louisville",
    "La Paz",
    "",
    "Yinchuan",
    "",
    "Copenhagen",
    "Lahore",
    "Bouak\303\251",
    "",
    "Nuuk",
    "",
    "",
    "Entebbe",
    "",
    "",
    "",
    "",
    "",
    "",
    "Petropavlovsk-Kamchatsky",
    "",
    "Cracow",
    "Iqaluit",
    "Wau",
    "Kathmandu",
    "",
    "",
    "",
    "",
    "",
    "Vientiane",
    "Havana",
    "",
    "",
    "",
    "Mzuzu",
    "Almaty",
    "",
    "",
    "Lviv",
    "Chittagong",
    "Roseau",
    "",
    "Timbuktu",
    "",
    "",
    "",
    "",
    "",
    "",
    "Lagos",
    "Niamey",
    "Indianapolis",
    "Jayapura",
    "Garoua",
    "",
    "Livingstone",
    "Yerevan",
    "",
    "",
    "Perth",
    "Madrid",
    "Houston",
    "",
    "",
    "",
    "",
    "",
    "",
    "Riga",
    "",
    "Luanda",
    "",
    "",
    "",
    "Libreville",
    "Lodwar",
    "Nicosia",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Tegucigalpa",
    "Reggane",
    "",
    "Nashville",
    "",
    "",
    "",
    "",
    "Cabo San Lucas",
    "",
    "S\303\251gou",
    "",
    "",
    "",
    "",
    "",
    "",
    "Odienn\303\251",
    "",
    "",
    "",
    "",
    "",
    "",
    "Mal\303\251",
    "Novosibirsk",
    "",
    "",
    "Cape Town",
    "Ahvaz",
    "",
    "",
    "",
    "Hong Kong",
    "Nouakchott",
    "Napier",
    "",
    "",
    "Edinburgh",
    "Luxembourg City",
    "Sydney",
    "",
    "",
    "Gagnoa",
    "",
    "Napoli",
    "Guatemala City",
    "Yaound\303\251",
    "George Town",
    "Virginia Beach",
    "",
    "",
    "",
    "Pyongyang",
    "Lubumbashi",
    "",
    "",
    "",
    "",
    "",
    "Hobart",
    "",
    "",
    "",
    "",
    "Gaborone",
    "Rangpur",
    "",
    "Gab\303\250s",
    "",
    "",
    "",
    "",
    "",
    "Assab",
    "",
    "",
    "",
    "New Delhi",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Lake Havasu City",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Budapest",
    "",
    "",
    "Ottawa",
    "",
    "Ab\303\251ch\303\251",
    "",
    "",
    "",
    "",
    "Auckland",
    "Mogadishu",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Hat Yai",
    "",
    "Chongqing",
    "",
    "Kuwait City",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Launceston",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Las Vegas",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Oklahoma City",
    "",
    "",
    "",
    "",
    "",
    "",
    "Oranjestad",
    "",
    "Hamburg",
    "",
    "",
    "",
    "",
    "Guangzhou",
    "",
    "",
    "",
    "",
    "Ngaound\303\251r\303\251",
    "",
    "Veracruz",
    "Rabat",
    "",
    "",
    "",
    "",
    "",
    "",
    "Baghdad",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Reykjav\303\255k",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Ho Chi Minh City",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "New Orleans",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Vaduz",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Nouadhibou",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Lom\303\251",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "Riyadh",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "",
    "New York City"
};

} // namespace rinku::brc::perfect_hash
